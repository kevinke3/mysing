{% extends "base.html" %}

{% block title %}{{ person.name }} - Case Details - Loket{% endblock %}

{% block content %}
<section class="case-details-section">
    <div class="container">
        <div class="case-details-header">
            <a href="{{ url_for('browse') }}" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Browse
            </a>
            <h1>Case Details: {{ person.name }}</h1>
        </div>
        
        <div class="case-details-content">
            <div class="case-image-large">
                <img src="{{ person.photo_url }}" alt="{{ person.name }}">
            </div>
            
            <div class="case-info-detailed">
                <div class="info-section">
                    <h3>Personal Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Name:</strong>
                            <span>{{ person.name }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Age:</strong>
                            <span>{{ person.age }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Gender:</strong>
                            <span>{{ person.gender }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Last Seen Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Location:</strong>
                            <span>{{ person.last_seen }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Date:</strong>
                            <span>{{ person.last_seen_date.strftime('%Y-%m-%d') }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Region:</strong>
                            <span>{{ person.region }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Physical Description</h3>
                    <p>{{ person.description }}</p>
                </div>
                
                <div class="info-section">
                    <h3>Contact Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Contact Person:</strong>
                            <span>{{ person.contact_name }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Phone:</strong>
                            <span id="contactPhone">{{ person.contact_phone }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Email:</strong>
                            <span>{{ person.contact_email }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Case Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Reported by:</strong>
                            <span>{{ person.reporter.name }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Date Reported:</strong>
                            <span>{{ person.date_reported.strftime('%Y-%m-%d') }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Status:</strong>
                            <span class="status-{{ 'found' if person.is_found else 'active' }}">
                                {{ 'Found' if person.is_found else 'Active' }}
                            </span>
                        </div>
                    </div>
                </div>
                
                {% if current_user.is_authenticated and not person.is_found %}
                <div class="action-buttons">
                    <a href="tel:{{ person.contact_phone|replace('(', '')|replace(')', '')|replace(' ', '')|replace('-', '') }}" 
                       class="btn btn-primary btn-call-report" id="callReporterBtn">
                        <i class="fas fa-phone"></i> Call Reporter to Report Sighting
                    </a>
                    <p class="call-guidance-small">
                        <i class="fas fa-info-circle"></i>
                        When you call, describe where and when you saw {{ person.name }}
                    </p>
                </div>
                {% elif not current_user.is_authenticated %}
                <div class="login-prompt">
                    <p><a href="{{ url_for('login') }}">Login</a> to contact the reporter about sightings.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Call Confirmation Modal -->
<div id="callModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="call-confirmation">
            <div class="call-icon">
                <i class="fas fa-phone"></i>
            </div>
            <h3>Ready to Call</h3>
            <p>You are about to call the contact person for this missing person case.</p>
            <div class="call-details">
                <p><strong>Contact:</strong> {{ person.contact_name }}</p>
                <p><strong>Phone:</strong> <span id="displayPhone">{{ person.contact_phone }}</span></p>
                <p><strong>Regarding:</strong> {{ person.name }}</p>
            </div>
            <div class="call-actions">
                <a href="tel:{{ person.contact_phone|replace('(', '')|replace(')', '')|replace(' ', '')|replace('-', '') }}" 
                   class="btn btn-primary btn-call">
                    <i class="fas fa-phone"></i> Call Now
                </a>
                <button class="btn btn-outline" id="cancelCallBtn">Cancel</button>
            </div>
            <div class="call-guidance">
                <h4>What to say when you call:</h4>
                <ul>
                    <li>"Hello, I'm calling from Loket about {{ person.name }}"</li>
                    <li>Describe where and when you saw the person</li>
                    <li>Mention what they were wearing or any distinctive features</li>
                    <li>Provide your name and contact information if comfortable</li>
                    <li>Be clear and calm in your description</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const callModal = document.getElementById('callModal');
    const callReporterBtn = document.getElementById('callReporterBtn');
    const closeModal = document.querySelector('.close-modal');
    const cancelCallBtn = document.getElementById('cancelCallBtn');
    
    if (callReporterBtn) {
        callReporterBtn.addEventListener('click', function(e) {
            e.preventDefault();
            callModal.style.display = 'block';
        });
    }
    
    // Close modal events
    closeModal.addEventListener('click', function() {
        callModal.style.display = 'none';
    });
    
    if (cancelCallBtn) {
        cancelCallBtn.addEventListener('click', function() {
            callModal.style.display = 'none';
        });
    }
    
    window.addEventListener('click', function(e) {
        if (e.target === callModal) {
            callModal.style.display = 'none';
        }
    });
});
</script>
{% endblock %}